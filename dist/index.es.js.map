{"version":3,"file":"index.es.js","sources":["../src/protocols.ts","../src/interpreter.ts","../src/Application.ts","../src/HashObject.ts","../src/Component.ts","../src/ComponentManager.ts","../src/EntityAdaptor.ts","../src/utils.ts"],"sourcesContent":["/**\n * Created by rockyl on 2020-03-11.\n */\n\nimport {Application} from \"./Application\";\n\n//todo script,dynamic\nexport enum Protocols {\n\tRES = 'res://',\n\tENTITY = 'entity://',\n}\n\nexport const protocols = {\n\t[Protocols.RES]: res,\n\t[Protocols.ENTITY]: entity,\n};\n\nfunction res(app: Application, key: string, value: any): any {\n\tlet trulyValue;\n\n\tconst uuid = value.replace(Protocols.RES, '');\n\ttrulyValue = app.getRes(uuid);\n\n\treturn trulyValue;\n}\n\nfunction entity(app: Application, key: string, value: any, pid?: number): any {\n\tlet trulyValue;\n\n\tconst uuid = transPrefabUUID(value.replace(Protocols.ENTITY, ''), pid);\n\ttrulyValue = app.entityMap[uuid];\n\n\treturn trulyValue;\n}\n\nfunction transPrefabUUID(uuid, pid: number) {\n\treturn pid ? pid + '_' + uuid : uuid;\n}\n","/**\n * Created by rockyl on 2020-03-10.\n */\n\nimport {IEntity} from \"./IEntity\";\nimport {Application} from \"./Application\";\nimport {protocols} from \"./protocols\";\n\nlet prefabID: number = 0;\n\n/**\n * 实例化节点树\n * @param app\n * @param docConfig\n */\nexport function instantiate(app: Application, docConfig: any) {\n\tlet pid;\n\tif (docConfig.docType === 'prefab') {\n\t\tpid = ++prefabID;\n\t}\n\tconst rootEntity = setupEntityTree(app, docConfig, pid);\n\tsetupComponent(app, docConfig, rootEntity, pid);\n\tenableComponent(app, docConfig, rootEntity, pid);\n\n\treturn rootEntity;\n}\n\n/**\n * 装配实体树\n * @param app\n * @param config\n * @param pid\n */\nfunction setupEntityTree(app: Application, config, pid?: number) {\n\tlet entity: IEntity = null;\n\tif (config) {\n\t\tlet {type, name, uuid, children} = config;\n\t\tif (pid !== undefined && uuid !== undefined) {\n\t\t\tuuid = pid + '_' + uuid;\n\t\t}\n\t\tentity = app.createEntity(type);\n\t\tif (name) {\n\t\t\tentity['name'] = name;\n\t\t}\n\t\tentity['uuid'] = uuid;\n\n\t\tinjectProps(app, entity, config.props);\n\n\t\tapp.entityMap[uuid] = entity;\n\n\t\tif (children) {\n\t\t\tfor (let child of children) {\n\t\t\t\tconst childEntity = setupEntityTree(app, child, pid);\n\t\t\t\tapp.addDisplayNode(childEntity, entity);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn entity;\n}\n\n/**\n * 装配组件\n * @param app\n * @param config\n * @param entity\n * @param pid\n */\nfunction setupComponent(app: Application, config, entity, pid?: number) {\n\tfor (let i = 0, li = entity.children.length; i < li; i++) {\n\t\tconst child: IEntity = entity.children[i];\n\t\tlet comps = config.children[i].comps;\n\t\tif (comps) {\n\t\t\tlet compManager = child.entityAdaptor.components;\n\t\t\tfor (let comp of comps) {\n\t\t\t\tlet component = compManager.addComponent(comp.id, false);\n\t\t\t\tcomponent.enabled = comp.enabled;\n\t\t\t\tinjectProps(app, component, comp.props, pid);\n\t\t\t\tcompManager.$onAddComponent(component, true);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * 使能组件\n * @param app\n * @param config\n * @param entity\n * @param pid\n */\nfunction enableComponent(app: Application, config, entity, pid?: number) {\n\tfor (let i = 0, li = entity.children.length; i < li; i++) {\n\t\tconst child: IEntity = entity.children[i];\n\n\t\tlet comps = config.children[i].comps;\n\t\tif (comps) {\n\t\t\tlet compManager = child.entityAdaptor.components;\n\t\t\tcompManager.setActive(true);\n\t\t}\n\t}\n}\n\n/**\n * 注入属性\n * @param app\n * @param target\n * @param props\n * @param pid\n */\nfunction injectProps(app: Application, target: any, props: any, pid?: number) {\n\tif (props) {\n\t\tfor (let field in props) {\n\t\t\tlet value = props[field];\n\t\t\tif (typeof value === 'object') {//复杂数据\n\t\t\t\ttransComplexProps(app, target, field, value)\n\t\t\t} else {\n\t\t\t\ttransBaseProps(app, target, field, value, pid);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction transComplexProps(app: Application, target: any, field: string, value: any, pid?: number) {\n\tlet trulyValue = value;\n\tlet override = false;\n\tswitch (value.type) {\n\t\tcase 'raw':\n\t\t\toverride = true;\n\t\t\ttrulyValue = value.data;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (Array.isArray(value) && !target[field]) {\n\t\t\t\ttarget[field] = [];\n\t\t\t}\n\t\t\tinjectProps(app, target[field], value, pid);\n\t\t\tbreak;\n\t}\n\n\tif (override) {\n\t\ttarget[field] = trulyValue;\n\t}\n}\n\n/**\n * 转换基础类型的属性\n * @param app\n * @param target\n * @param field\n * @param value\n * @param pid\n */\nfunction transBaseProps(app: Application, target: any, field: string, value: any, pid?: number) {\n\tlet trulyValue = value;\n\tif (typeof value === 'string') {\n\t\tlet hit;\n\t\tlet protocolGroups = [protocols, app.options.protocols];\n\t\tfor (let protocols of protocolGroups) {\n\t\t\tfor (let protocol in protocols) {\n\t\t\t\tif (value.indexOf(protocol) === 0) {\n\t\t\t\t\tlet protocolFunc = protocols[protocol];\n\t\t\t\t\ttrulyValue = protocolFunc(app, field, value, pid);\n\t\t\t\t\thit = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hit) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\ttarget[field] = trulyValue;\n}\n","/**\n * Created by rockyl on 2020-03-08.\n */\n\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\nimport {IEntity} from \"./IEntity\";\nimport {instantiate} from \"./interpreter\";\n\nexport interface AdaptorOptions {\n\tstage: any;\n\tEntityAdaptor: any;\n\taddDisplayFunc: (node: IEntity, parent: IEntity) => void;\n\ttraverseFunc: (node: IEntity, callback: (node) => boolean | void) => void;\n\tloadResourceFunc: (configs, onProgress?, onComplete?) => void;\n\tgetResFunc: (name) => any;\n\tprotocols?: {\n\t\t[key: string]: (app: Application, key: string, value: any, pid?:number) => any,\n\t};\n}\n\n/**\n * 应用\n */\nexport class Application {\n\tprivate _options: AdaptorOptions;\n\tprivate _componentDefs: any = {};\n\tprivate _entityDefs: any = {};\n\n\tentityMap = {};\n\n\t/**\n\t * 配置\n\t */\n\tget options(): AdaptorOptions{\n\t\treturn this._options;\n\t}\n\n\t/**\n\t * 舞台实例\n\t */\n\tget stage() {\n\t\treturn this._options.stage;\n\t}\n\n\t/**\n\t * 装配适配器\n\t * @param options\n\t * @return mainLoop 主循环方法\n\t */\n\tsetupAdaptor(options: AdaptorOptions): (delta: number) => void {\n\t\tthis._options = options;\n\t\treturn this._mainLoop;\n\t}\n\n\t/**\n\t * 实例化场景或者预制体\n\t * @param docConfig\n\t */\n\tinstantiate(docConfig: any) {\n\t\treturn instantiate(this, docConfig);\n\t}\n\n\t/**\n\t * 注册组件类\n\t * @param id\n\t * @param def\n\t */\n\tregisterComponentDef(id, def) {\n\t\tif (def) {\n\t\t\tdef['__class__'] = id;\n\t\t\tthis._componentDefs[id] = def;\n\t\t}\n\t}\n\n\t/**\n\t * 批量注册组件类\n\t * @param defs {key: id, def}\n\t */\n\tregisterComponentDefs(defs) {\n\t\tif (defs) {\n\t\t\tfor (let id in defs) {\n\t\t\t\tthis.registerComponentDef(id, defs[id]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 注册实体类\n\t * @param type\n\t * @param def\n\t */\n\tregisterEntityDef(type, def) {\n\t\tif (def) {\n\t\t\tthis._entityDefs[type] = def;\n\t\t}\n\t}\n\n\t/**\n\t * 批量注册实体类\n\t * @param defs\n\t */\n\tregisterEntityDefs(defs) {\n\t\tif (defs) {\n\t\t\tfor (let type in defs) {\n\t\t\t\tthis.registerEntityDef(type, defs[type].def);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 创建实体实例\n\t * @param type\n\t */\n\tcreateEntity(type: string): IEntity {\n\t\tlet clazz = this._entityDefs[type];\n\n\t\tif (clazz) {\n\t\t\tlet entity = new clazz();\n\t\t\tlet entityAdaptor = new this._options.EntityAdaptor(entity, this);\n\n\t\t\treturn entity;\n\t\t} else {\n\t\t\tthrow new Error(`type [${type}] not exists.`)\n\t\t}\n\t}\n\n\t/**\n\t * 添加显示节点\n\t * @param node\n\t * @param parent\n\t */\n\taddDisplayNode(node: IEntity, parent: IEntity) {\n\t\tthis._options.addDisplayFunc(node, parent);\n\t}\n\n\t/**\n\t * 遍历显示节点\n\t * @param node\n\t * @param callback\n\t */\n\ttraverseDisplayNode(node: IEntity, callback: (node) => boolean | void) {\n\t\tthis._options.traverseFunc(node, callback);\n\t}\n\n\t/**\n\t * 加载资源\n\t * @param configs\n\t * @param onProgress\n\t * @param onComplete\n\t */\n\tloadResource(configs, onProgress?, onComplete?) {\n\t\tthis._options.loadResourceFunc(configs, onProgress, onComplete);\n\t}\n\n\t/**\n\t * 获取资源\n\t * @param name\n\t */\n\tgetRes(name): any {\n\t\treturn this._options.getResFunc(name);\n\t}\n\n\t/**\n\t * 主循环方法，需要在适配器的实现中调用\n\t * @param delta\n\t * @private\n\t */\n\tprivate _mainLoop = (delta: number) => {\n\t\tthis._options.traverseFunc(this._options.stage, this._onHit.bind(this, delta))\n\t};\n\n\t/**\n\t * 遍历整个渲染树\n\t * @param delta\n\t * @param node\n\t * @private\n\t */\n\tprivate _onHit(delta, node) {\n\t\tif (node['entityAdaptor']) {\n\t\t\tlet entityAdaptor: IEntityAdaptor = node['entityAdaptor'];\n\t\t\tentityAdaptor.invokeLifecycle('update', delta);\n\t\t}\n\t}\n\n\t/**\n\t * 实例化组件\n\t * @param id\n\t */\n\t$getComponentDef(id: any): any {\n\t\tlet def;\n\t\tlet idType = typeof id;\n\t\tswitch (idType) {\n\t\t\tcase 'string':\n\t\t\t\tdef = this._componentDefs[id];\n\t\t\t\tbreak;\n\t\t\tcase 'function':\n\t\t\t\tdef = id;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (!def) {\n\t\t\tconsole.warn(`component [${id}] not exists.`);\n\t\t\treturn;\n\t\t}\n\t\tconst className = def['__class__'];\n\t\tif (!className) {\n\t\t\tconsole.warn(`component [${id}] is not registered.`);\n\t\t\treturn;\n\t\t}\n\n\t\treturn def;\n\t}\n}\n","/**\n * Created by rockyl on 2018/11/5.\n */\n\nlet HASH_CODE_INK: number = 0;\n\nfunction getHashCode() {\n\treturn ++HASH_CODE_INK;\n}\n\n/**\n * 哈希对象\n */\nexport class HashObject {\n\tprivate _hashCode: number;\n\n\tconstructor() {\n\t\tthis._hashCode = getHashCode();\n\t}\n\n\tget hashCode(): number {\n\t\treturn this._hashCode;\n\t}\n}\n","/**\n * Created by rockyl on 2019-07-28.\n */\n\nimport {HashObject} from \"./HashObject\";\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\n\nexport interface IComponent {\n\treadonly entityAdaptor: IEntityAdaptor;\n\treadonly entity: any;\n\tenabled: boolean;\n\n\tawake();\n\n\tstart();\n\n\tonEnable();\n\n\tonDisable();\n\n\tupdate(t: number);\n\n\tonDestroy();\n\n\tonClick(e);\n\n\tonMouseDown(e);\n\n\tonMouseMove(e);\n\n\tonMouseUp(e);\n\n\tonMouseUpOutside(e);\n}\n\n/**\n * 组件类\n */\nexport class Component extends HashObject implements IComponent {\n\tprivate _entityAdaptor: IEntityAdaptor;\n\tprivate _enabled: boolean = false;\n\tprivate _started: boolean = false;\n\n\tget entityAdaptor(): IEntityAdaptor {\n\t\treturn this._entityAdaptor;\n\t}\n\n\tget entity(): any {\n\t\treturn this._entityAdaptor.entity;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t}\n\n\t/**\n\t * 是否有效\n\t */\n\tget enabled(): boolean {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tif (this._enabled != value) {\n\t\t\tthis._enabled = value;\n\n\t\t\tif (this._entityAdaptor && this._entityAdaptor.getActive()) {\n\t\t\t\tif (value) {\n\t\t\t\t\tthis._started = false;\n\t\t\t\t\tthis.onEnable();\n\t\t\t\t} else {\n\t\t\t\t\tthis.onDisable();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\t$awake(entityAdaptor: IEntityAdaptor) {\n\t\tthis._entityAdaptor = entityAdaptor;\n\t\tthis.awake();\n\t}\n\n\t/**\n\t * @private\n\t */\n\t$destroy() {\n\t\tthis._entityAdaptor = null;\n\t\tthis.onDestroy();\n\t}\n\n\t/**\n\t * 当组件被唤醒时\n\t */\n\tawake() {\n\n\t}\n\n\t/**\n\t * 当组件开始\n\t */\n\tstart() {\n\n\t}\n\n\t/**\n\t * 当生效时\n\t * 仅当实体唤醒状态\n\t */\n\tonEnable() {\n\n\t}\n\n\t/**\n\t * 当失效时\n\t * 仅当实体唤醒状态\n\t */\n\tonDisable() {\n\n\t}\n\n\t/**\n\t * 时钟更新\n\t * @param t\n\t */\n\tupdate(t: number) {\n\n\t}\n\n\t/**\n\t * 当被销毁时\n\t */\n\tonDestroy() {\n\n\t}\n\n\t/**\n\t * @private\n\t * @param t\n\t */\n\t$onUpdate(t: number) {\n\t\tif (this._enabled) {\n\t\t\tif (!this._started) {\n\t\t\t\tthis._started = true;\n\t\t\t\tthis.start();\n\t\t\t}\n\t\t\tthis.update(t);\n\t\t}\n\t}\n\n\tonClick(e) {\n\t}\n\n\tonMouseDown(e) {\n\t}\n\n\tonMouseMove(e) {\n\t}\n\n\tonMouseUp(e) {\n\t}\n\n\tonMouseUpOutside(e) {\n\t}\n}\n","/**\n * Created by rockyl on 2019-07-29.\n */\n\nimport {Component} from \"./Component\";\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\nimport {Application} from \"./Application\";\n\n/**\n * 组件管理类\n */\nexport class ComponentManager {\n\tprivate _app: Application;\n\tprivate _entityAdaptor: IEntityAdaptor;\n\tprivate _components: Component[] = [];\n\tprivate _componentsNameMapping: any;\n\tprivate _componentsDefMapping: any;\n\n\tconstructor(entityAdaptor: IEntityAdaptor, app: Application) {\n\t\tthis._app = app;\n\t\tthis._entityAdaptor = entityAdaptor;\n\n\t\tthis.applyProxy();\n\t}\n\n\tapplyProxy() {\n\t\tlet entity = this._entityAdaptor.entity;\n\n\t\tentity.addComponent = (componentId: string | Function) => {\n\t\t\treturn this.addComponent(componentId);\n\t\t};\n\t\tentity.removeComponent = (componentId: string | Function, index?: number) => {\n\t\t\treturn this.removeComponent(componentId, index);\n\t\t};\n\t\tentity.removeAllComponents = () => {\n\t\t\tthis.removeAllComponents();\n\t\t};\n\t\tentity.getComponent = (componentId: string | Function) => {\n\t\t\treturn this.getComponent(componentId);\n\t\t};\n\t\tentity.getComponents = (componentId: string | Function) => {\n\t\t\treturn this.getComponents(componentId);\n\t\t};\n\t}\n\n\t/**\n\t * 遍历组件\n\t * @param callback\n\t */\n\teachComponent(callback: (component: Component, index: number) => unknown) {\n\t\tthis._components.some(<any>callback);\n\t}\n\n\t/**\n\t * 设置激活状态\n\t * @param active\n\t */\n\tsetActive(active: boolean) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tif (active) {\n\t\t\t\t\tcomponent.onEnable();\n\t\t\t\t} else {\n\t\t\t\t\tcomponent.onDisable();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 时钟更新\n\t * @param t\n\t */\n\tonUpdate(t: number) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tcomponent.$onUpdate(t);\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 交互事件\n\t */\n\tonInteract(type: string, e) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tlet method = 'on' + type[0].toUpperCase() + type.substr(1);\n\n\t\t\t\tif (component[method]) {\n\t\t\t\t\tcomponent[method](e);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 添加组件\n\t * @param componentId\n\t * @param awake\n\t */\n\taddComponent(componentId: any, awake = true) {\n\t\tlet component = this.$instantiateComponent(componentId);\n\t\tif (!component) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._add(component, undefined, awake);\n\n\t\treturn component;\n\t}\n\n\t/**\n\t * 移除组件\n\t * @param componentId\n\t * @param index\n\t */\n\tremoveComponent(componentId: any, index?: number) {\n\t\tlet components;\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\tcomponents = this._findByName(componentId);\n\t\t\t\tbreak;\n\t\t\tcase 'function':\n\t\t\t\tcomponents = this._find(componentId);\n\t\t\t\tbreak;\n\t\t}\n\t\tif (index !== undefined) {\n\t\t\tcomponents = [components[index]];\n\t\t}\n\n\t\tthis._remove(components);\n\n\t\treturn components;\n\t}\n\n\t/**\n\t * 移除所有组件\n\t */\n\tremoveAllComponents() {\n\t\tthis._removeAll();\n\t}\n\n\t/**\n\t * 获取组件\n\t * @param componentId\n\t */\n\tgetComponent(componentId) {\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\treturn this._getByName(componentId);\n\t\t\tcase 'function':\n\t\t\t\treturn this._getOne(componentId);\n\t\t}\n\t}\n\n\t/**\n\t * 获取组件组\n\t * @param componentId\n\t */\n\tgetComponents(componentId) {\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\treturn this._findByName(componentId);\n\t\t\tcase 'function':\n\t\t\t\treturn this._find(componentId);\n\t\t}\n\t}\n\n\t/**\n\t * 获取全部组件\n\t */\n\tgetAllComponents(){\n\t\treturn this.all;\n\t}\n\n\t/**\n\t * 添加组件\n\t * @param component\n\t * @param index\n\t * @param awake\n\t */\n\tprivate _add(component: Component, index?: number, awake = true) {\n\n\t\tif (index == undefined || index < 0 || index >= this._components.length) {\n\t\t\tindex = this._components.length;\n\t\t}\n\n\t\tif (component.entityAdaptor == this._entityAdaptor) {\n\t\t\tindex--;\n\t\t}\n\n\t\tconst currentIndex = this._components.indexOf(component);\n\t\tif (currentIndex == index) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentIndex >= 0) {\n\t\t\tthis._components.splice(currentIndex, 1);\n\t\t}\n\t\tthis._components.splice(index, 0, component);\n\n\t\tif (currentIndex < 0) {\n\t\t\tthis.$onAddComponent(component, awake);\n\t\t}\n\t}\n\n\t/**\n\t * 移除组件\n\t * @param components\n\t */\n\tprivate _remove(components) {\n\t\tfor (let component of components) {\n\t\t\tif (component) {\n\t\t\t\tthis.$onRemoveComponent(component);\n\t\t\t\tconst index = this._components.indexOf(component);\n\t\t\t\tthis._components.splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 移除所有组件\n\t */\n\tprivate _removeAll() {\n\t\twhile (this._components.length > 0) {\n\t\t\tconst component = this._components.shift();\n\t\t\tthis.$onRemoveComponent(component);\n\t\t}\n\t}\n\n\t/**\n\t * 根据组件名称获取指定类的组件列表\n\t * @param componentId\n\t */\n\tprivate _findByName<T extends Component>(componentId: string): T[] {\n\t\tlet components = this._componentsNameMapping[componentId];\n\t\tif (!components) {\n\t\t\tcomponents = this._componentsNameMapping[componentId] = <T[]>this._components.filter((component: Component) => {\n\t\t\t\treturn component.constructor['__class__'] === componentId;\n\t\t\t});\n\t\t}\n\t\treturn components;\n\t}\n\n\t/**\n\t * 获取指定类的组件列表\n\t * @param clazz\n\t */\n\tprivate _find<T extends Component>(clazz: new() => T): T[] {\n\t\tlet components = this._componentsDefMapping[clazz.name];\n\t\tif (!components) {\n\t\t\tcomponents = this._componentsDefMapping[clazz.name] = <T[]>this._components.filter((component: Component) => {\n\t\t\t\treturn component instanceof clazz;\n\t\t\t});\n\t\t}\n\t\treturn components;\n\t}\n\n\t/**\n\t * 获取指定类的组件\n\t * @param name\n\t */\n\tprivate _getByName<T extends Component>(name: string): T {\n\t\treturn this._findByName<T>(name)[0];\n\t}\n\n\t/**\n\t * 获取指定类的组件\n\t * @param clazz\n\t */\n\tprivate _getOne<T extends Component>(clazz: new() => T): T {\n\t\treturn this._find<T>(clazz)[0];\n\t}\n\n\t/**\n\t * 获取所有组件\n\t */\n\tprivate get all(): Component[] {\n\t\treturn this._components;\n\t}\n\n\t/**\n\t * 当添加组件时\n\t * @param component\n\t * @param awake\n\t */\n\t$onAddComponent(component: Component, awake = true) {\n\t\tthis._componentsNameMapping = {};\n\t\tthis._componentsDefMapping = {};\n\n\t\tif(awake){\n\t\t\tcomponent.$awake(this._entityAdaptor);\n\t\t}\n\t}\n\n\t/**\n\t * 当移除组件时\n\t * @param component\n\t */\n\t$onRemoveComponent(component: Component) {\n\t\tthis._componentsNameMapping = {};\n\t\tthis._componentsDefMapping = {};\n\n\t\tcomponent.enabled = false;\n\t\tcomponent.$destroy();\n\t}\n\n\t$instantiateComponent(componentId: any): Component {\n\t\tlet def = this._app.$getComponentDef(componentId);\n\t\treturn new def();\n\t}\n}\n","/**\n * Created by rockyl on 2020-03-07.\n */\n\nimport {ComponentManager} from \"./ComponentManager\";\nimport {Application} from \"./Application\";\n\n/**\n * 实体适配器接口\n */\nexport interface IEntityAdaptor {\n\t/**\n\t * 组件管理实例\n\t */\n\treadonly entity: any;\n\t/**\n\t * 实体\n\t */\n\treadonly components: ComponentManager;\n\n\t/**\n\t * 获取激活状态\n\t */\n\tgetActive(): boolean;\n\n\t/**\n\t * 设置激活状态\n\t * @param active\n\t */\n\tsetActive(active: boolean);\n\n\tinvokeLifecycle(type: string, ...args);\n\n\tinvokeInteractionEvent(type: string, ...args);\n}\n\n/**\n * 实体适配器基类\n */\nexport abstract class EntityAdaptorBase implements IEntityAdaptor {\n\tprotected readonly _components: ComponentManager;\n\tprotected readonly _entity: any;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tget components(): ComponentManager {\n\t\treturn this._components;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tget entity() {\n\t\treturn this._entity;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetActive(): boolean {\n\t\treturn this._entity.$active;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tsetActive(v: boolean) {\n\t\tif (v !== this.getActive()) {\n\t\t\tthis._entity.$active = v;\n\t\t\tthis._components.setActive(v);\n\t\t}\n\t}\n\n\tconstructor(entity: any, app: Application) {\n\t\tthis._entity = entity;\n\t\tthis._components = new ComponentManager(this, app);\n\n\t\tentity.entityAdaptor = this;\n\n\t\tthis.applyProxy();\n\t}\n\n\t/**\n\t * 应用代理\n\t */\n\tapplyProxy() {\n\t\tlet entity = this._entity;\n\t\tentity.$active = true;\n\n\t\tObject.defineProperty(entity, 'active', {\n\t\t\tget() {\n\t\t\t\treturn this.entityAdaptor.getActive();\n\t\t\t}\n\t\t});\n\t\tentity.setActive = this.setActive.bind(this);\n\t}\n\n\t/**\n\t * 触发生命周期方法\n\t * @param type\n\t * @param args\n\t */\n\tinvokeLifecycle(type: string, ...args) {\n\t\tif(!this.getActive()){\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (type) {\n\t\t\tcase 'update':\n\t\t\t\tconst [delta] = args;\n\t\t\t\tthis._components.onUpdate(delta);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * 触发交互事件方法\n\t * @param type\n\t * @param e\n\t */\n\tinvokeInteractionEvent(type: string, e) {\n\t\tif(!this.getActive()){\n\t\t\treturn;\n\t\t}\n\n\t\tthis._components.onInteract(type, e);\n\t}\n}\n","/**\n * Created by rockyl on 2020-03-09.\n */\n\n/**\n * 线性插值\n * @param begin number\n * @param end number\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerp(begin: number, end: number, t: number, allowOutOfBounds = false) {\n\tif (!allowOutOfBounds) {\n\t\tt = Math.max(0, Math.min(1, t));\n\t}\n\n\tlet sign = end - begin;\n\tsign = sign > 0 ? 1 : (sign < 0 ? -1 : 0);\n\tconst distance = Math.abs(end - begin);\n\n\treturn begin + distance * t * sign;\n}\n\n/**\n * 线性插值\n * @param begin\n * @param end\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerpVector2(begin: {x: number, y: number}, end: {x: number, y: number}, t: number, allowOutOfBounds = false) {\n\treturn {\n\t\tx: lerp(begin.x, end.x, t, allowOutOfBounds),\n\t\ty: lerp(begin.y, end.y, t, allowOutOfBounds),\n\t};\n}\n\n/**\n * 线性插值\n * @param begin\n * @param end\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerpVector3(begin: {x: number, y: number, z: number}, end: {x: number, y: number,  z: number}, t: number, allowOutOfBounds = false) {\n\treturn {\n\t\tx: lerp(begin.x, end.x, t, allowOutOfBounds),\n\t\ty: lerp(begin.y, end.y, t, allowOutOfBounds),\n\t\tz: lerp(begin.z, end.z, t, allowOutOfBounds),\n\t};\n}\n"],"names":["tslib_1.__extends"],"mappings":"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"}