{"version":3,"file":"index.umd.js","sources":["../src/protocols.ts","../src/interpreter.ts","../src/Application.ts","../src/HashObject.ts","../src/Component.ts","../src/ComponentManager.ts","../src/EntityAdaptor.ts","../src/utils.ts"],"sourcesContent":["/**\n * Created by rockyl on 2020-03-11.\n */\n\nimport {Application} from \"./Application\";\n\nexport enum Protocols {\n\tRES = 'res://',\n\tENTITY = 'entity://',\n}\n\nexport const protocols = {\n\t[Protocols.RES]: res,\n\t[Protocols.ENTITY]: entity,\n};\n\nfunction res(app: Application, key: string, value: any): any {\n\tlet trulyValue;\n\n\tconst uuid = value.replace(Protocols.RES, '');\n\ttrulyValue = app.getRes(uuid);\n\n\treturn trulyValue;\n}\n\nfunction entity(app: Application, key: string, value: any, pid?: number): any {\n\tlet trulyValue;\n\n\tconst uuid = transPrefabUUID(value.replace(Protocols.ENTITY, ''), pid);\n\ttrulyValue = app.entityMap[uuid];\n\n\treturn trulyValue;\n}\n\nfunction transPrefabUUID(uuid, pid: number) {\n\treturn pid ? pid + '_' + uuid : uuid;\n}\n","/**\n * Created by rockyl on 2020-03-10.\n */\n\nimport {IEntity} from \"./IEntity\";\nimport {Application} from \"./Application\";\nimport {protocols} from \"./protocols\";\n\nlet prefabID: number = 0;\n\n/**\n * 实例化节点树\n * @param app\n * @param docConfig\n */\nexport function instantiate(app: Application, docConfig: any) {\n\tlet pid;\n\tif (docConfig.docType === 'prefab') {\n\t\tpid = ++prefabID;\n\t}\n\tconst rootEntity = setupEntityTree(app, docConfig, pid);\n\tsetupComponent(app, docConfig, rootEntity, pid);\n\n\treturn rootEntity;\n}\n\nfunction setupEntityTree(app: Application, config, pid?: number) {\n\tlet entity: IEntity = null;\n\tif (config) {\n\t\tlet {type, name, uuid, children} = config;\n\t\tif (pid !== undefined && uuid !== undefined) {\n\t\t\tuuid = pid + '_' + uuid;\n\t\t}\n\t\tentity = app.createEntity(type);\n\t\tif (name) {\n\t\t\tentity['name'] = name;\n\t\t}\n\t\tentity['uuid'] = uuid;\n\n\t\tinjectProps(app, entity, config.props);\n\n\t\tapp.entityMap[uuid] = entity;\n\n\t\tif (children) {\n\t\t\tfor (let child of children) {\n\t\t\t\tconst childEntity = setupEntityTree(app, child, pid);\n\t\t\t\tapp.addDisplayNode(childEntity, entity);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn entity;\n}\n\nfunction setupComponent(app: Application, config, entity, pid?: number) {\n\tfor (let i = 0, li = entity.children.length; i < li; i++) {\n\t\tconst child: IEntity = entity.children[i];\n\t\tlet comps = config.children[i].comps;\n\t\tif (comps) {\n\t\t\tfor (let comp of comps) {\n\t\t\t\tlet component = child.addComponent(comp.id);\n\n\t\t\t\tinjectProps(app, component, comp.props, pid);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction injectProps(app: Application, target: any, props: any, pid?: number) {\n\tif (props) {\n\t\tfor (let field in props) {\n\t\t\tlet value = props[field];\n\t\t\tlet trulyValue = value;\n\t\t\tif (typeof value === 'string') {\n\t\t\t\tlet hit;\n\t\t\t\tlet protocolGroups = [protocols, app.options.protocols];\n\t\t\t\tfor(let protocols of protocolGroups){\n\t\t\t\t\tfor (let protocol in protocols) {\n\t\t\t\t\t\tif (value.indexOf(protocol) === 0) {\n\t\t\t\t\t\t\tlet protocolFunc = protocols[protocol];\n\t\t\t\t\t\t\ttrulyValue = protocolFunc(app, field, value, pid);\n\t\t\t\t\t\t\thit = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(hit){\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\ttarget[field] = trulyValue;\n\t\t}\n\t}\n}\n\nfunction transPrefabUUID(uuid, pid: number) {\n\treturn pid ? pid + '_' + uuid : uuid;\n}\n","/**\n * Created by rockyl on 2020-03-08.\n */\n\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\nimport {IEntity} from \"./IEntity\";\nimport {instantiate} from \"./interpreter\";\n\nexport interface AdaptorOptions {\n\tstage: any;\n\tEntityAdaptor: any;\n\taddDisplayFunc: (node: IEntity, parent: IEntity) => void;\n\ttraverseFunc: (node: IEntity, callback: (node) => boolean | void) => void;\n\tloadResourceFunc: (configs, onProgress?, onComplete?) => void;\n\tgetResFunc: (name) => any;\n\tprotocols?: {\n\t\t[key: string]: (app: Application, key: string, value: any, pid?:number) => any,\n\t};\n}\n\n/**\n * 应用\n */\nexport class Application {\n\tprivate _options: AdaptorOptions;\n\tprivate _componentDefs: any = {};\n\tprivate _entityDefs: any = {};\n\n\tentityMap = {};\n\n\t/**\n\t * 配置\n\t */\n\tget options(): AdaptorOptions{\n\t\treturn this._options;\n\t}\n\n\t/**\n\t * 舞台实例\n\t */\n\tget stage() {\n\t\treturn this._options.stage;\n\t}\n\n\t/**\n\t * 装配适配器\n\t * @param options\n\t * @return mainLoop 主循环方法\n\t */\n\tsetupAdaptor(options: AdaptorOptions): (delta: number) => void {\n\t\tthis._options = options;\n\t\treturn this._mainLoop;\n\t}\n\n\t/**\n\t * 实例化场景或者预制体\n\t * @param docConfig\n\t */\n\tinstantiate(docConfig: any) {\n\t\treturn instantiate(this, docConfig);\n\t}\n\n\t/**\n\t * 注册组件类\n\t * @param id\n\t * @param def\n\t */\n\tregisterComponentDef(id, def) {\n\t\tif (def) {\n\t\t\tdef['__class__'] = id;\n\t\t\tthis._componentDefs[id] = def;\n\t\t}\n\t}\n\n\t/**\n\t * 批量注册组件类\n\t * @param defs {key: id, def}\n\t */\n\tregisterComponentDefs(defs) {\n\t\tif (defs) {\n\t\t\tfor (let id in defs) {\n\t\t\t\tthis.registerComponentDef(id, defs[id]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 注册实体类\n\t * @param type\n\t * @param def\n\t */\n\tregisterEntityDef(type, def) {\n\t\tif (def) {\n\t\t\tthis._entityDefs[type] = def;\n\t\t}\n\t}\n\n\t/**\n\t * 批量注册实体类\n\t * @param defs\n\t */\n\tregisterEntityDefs(defs) {\n\t\tif (defs) {\n\t\t\tfor (let type in defs) {\n\t\t\t\tthis.registerEntityDef(type, defs[type].def);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 创建实体实例\n\t * @param type\n\t */\n\tcreateEntity(type: string): IEntity {\n\t\tlet clazz = this._entityDefs[type];\n\n\t\tif (clazz) {\n\t\t\tlet entity = new clazz();\n\t\t\tlet entityAdaptor = new this._options.EntityAdaptor(entity, this);\n\n\t\t\treturn entity;\n\t\t} else {\n\t\t\tthrow new Error(`type [${type}] not exists.`)\n\t\t}\n\t}\n\n\t/**\n\t * 添加显示节点\n\t * @param node\n\t * @param parent\n\t */\n\taddDisplayNode(node: IEntity, parent: IEntity) {\n\t\tthis._options.addDisplayFunc(node, parent);\n\t}\n\n\t/**\n\t * 遍历显示节点\n\t * @param node\n\t * @param callback\n\t */\n\ttraverseDisplayNode(node: IEntity, callback: (node) => boolean | void) {\n\t\tthis._options.traverseFunc(node, callback);\n\t}\n\n\t/**\n\t * 加载资源\n\t * @param configs\n\t * @param onProgress\n\t * @param onComplete\n\t */\n\tloadResource(configs, onProgress?, onComplete?) {\n\t\tthis._options.loadResourceFunc(configs, onProgress, onComplete);\n\t}\n\n\t/**\n\t * 获取资源\n\t * @param name\n\t */\n\tgetRes(name): any {\n\t\treturn this._options.getResFunc(name);\n\t}\n\n\t/**\n\t * 主循环方法，需要在适配器的实现中调用\n\t * @param delta\n\t * @private\n\t */\n\tprivate _mainLoop = (delta: number) => {\n\t\tthis._options.traverseFunc(this._options.stage, this._onHit.bind(this, delta))\n\t};\n\n\t/**\n\t * 遍历整个渲染树\n\t * @param delta\n\t * @param node\n\t * @private\n\t */\n\tprivate _onHit(delta, node) {\n\t\tif (node['entityAdaptor']) {\n\t\t\tlet entityAdaptor: IEntityAdaptor = node['entityAdaptor'];\n\t\t\tentityAdaptor.invokeLifecycle('update', delta);\n\t\t}\n\t}\n\n\t/**\n\t * 实例化组件\n\t * @param id\n\t */\n\t$getComponentDef(id: any): any {\n\t\tlet def;\n\t\tlet idType = typeof id;\n\t\tswitch (idType) {\n\t\t\tcase 'string':\n\t\t\t\tdef = this._componentDefs[id];\n\t\t\t\tbreak;\n\t\t\tcase 'function':\n\t\t\t\tdef = id;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (!def) {\n\t\t\tconsole.warn(`component [${id}] not exists.`);\n\t\t\treturn;\n\t\t}\n\t\tconst className = def['__class__'];\n\t\tif (!className) {\n\t\t\tconsole.warn(`component [${id}] is not registered.`);\n\t\t\treturn;\n\t\t}\n\n\t\treturn def;\n\t}\n}\n","/**\n * Created by rockyl on 2018/11/5.\n */\n\nlet HASH_CODE_INK: number = 0;\n\nfunction getHashCode() {\n\treturn ++HASH_CODE_INK;\n}\n\n/**\n * 哈希对象\n */\nexport class HashObject {\n\tprivate _hashCode: number;\n\n\tconstructor() {\n\t\tthis._hashCode = getHashCode();\n\t}\n\n\tget hashCode(): number {\n\t\treturn this._hashCode;\n\t}\n}\n","/**\n * Created by rockyl on 2019-07-28.\n */\n\nimport {HashObject} from \"./HashObject\";\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\n\nexport interface IComponent {\n\treadonly entityAdaptor: IEntityAdaptor;\n\treadonly entity: any;\n\tenabled: boolean;\n\n\tawake();\n\n\tstart();\n\n\tonEnable();\n\n\tonDisable();\n\n\tupdate(t: number);\n\n\tonDestroy();\n\n\tonClick(e);\n\n\tonMouseDown(e);\n\n\tonMouseMove(e);\n\n\tonMouseUp(e);\n\n\tonMouseUpOutside(e);\n}\n\n/**\n * 组件类\n */\nexport class Component extends HashObject implements IComponent {\n\tprivate _entityAdaptor: IEntityAdaptor;\n\tprivate _enabled: boolean = false;\n\tprivate _started: boolean = false;\n\n\tget entityAdaptor(): IEntityAdaptor {\n\t\treturn this._entityAdaptor;\n\t}\n\n\tget entity(): any {\n\t\treturn this._entityAdaptor.entity;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t}\n\n\t/**\n\t * 是否有效\n\t */\n\tget enabled(): boolean {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tif (this._enabled != value) {\n\t\t\tthis._enabled = value;\n\n\t\t\tif (this._entityAdaptor && this._entityAdaptor.getActive()) {\n\t\t\t\tif (value) {\n\t\t\t\t\tthis._started = false;\n\t\t\t\t\tthis.onEnable();\n\t\t\t\t} else {\n\t\t\t\t\tthis.onDisable();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t */\n\t$awake(entityAdaptor: IEntityAdaptor) {\n\t\tthis._entityAdaptor = entityAdaptor;\n\t\tthis.enabled = true;\n\t\tthis.awake();\n\t}\n\n\t/**\n\t * @private\n\t */\n\t$destroy() {\n\t\tthis._entityAdaptor = null;\n\t\tthis.onDestroy();\n\t}\n\n\t/**\n\t * 当组件被唤醒时\n\t */\n\tawake() {\n\n\t}\n\n\t/**\n\t * 当组件开始\n\t */\n\tstart() {\n\n\t}\n\n\t/**\n\t * 当生效时\n\t * 仅当实体唤醒状态\n\t */\n\tonEnable() {\n\n\t}\n\n\t/**\n\t * 当失效时\n\t * 仅当实体唤醒状态\n\t */\n\tonDisable() {\n\n\t}\n\n\t/**\n\t * 时钟更新\n\t * @param t\n\t */\n\tupdate(t: number) {\n\n\t}\n\n\t/**\n\t * 当被销毁时\n\t */\n\tonDestroy() {\n\n\t}\n\n\t/**\n\t * @private\n\t * @param t\n\t */\n\t$onUpdate(t: number) {\n\t\tif (this._enabled) {\n\t\t\tif (!this._started) {\n\t\t\t\tthis._started = true;\n\t\t\t\tthis.start();\n\t\t\t}\n\t\t\tthis.update(t);\n\t\t}\n\t}\n\n\tonClick(e) {\n\t}\n\n\tonMouseDown(e) {\n\t}\n\n\tonMouseMove(e) {\n\t}\n\n\tonMouseUp(e) {\n\t}\n\n\tonMouseUpOutside(e) {\n\t}\n}\n","/**\n * Created by rockyl on 2019-07-29.\n */\n\nimport {Component} from \"./Component\";\nimport {IEntityAdaptor} from \"./EntityAdaptor\";\nimport {Application} from \"./Application\";\n\n/**\n * 组件管理类\n */\nexport class ComponentManager {\n\tprivate _app: Application;\n\tprivate _entityAdaptor: IEntityAdaptor;\n\tprivate _components: Component[] = [];\n\tprivate _componentsNameMapping: any;\n\tprivate _componentsDefMapping: any;\n\n\tconstructor(IEntityAdaptor: IEntityAdaptor, app: Application) {\n\t\tthis._app = app;\n\t\tthis._entityAdaptor = IEntityAdaptor;\n\n\t\tthis.applyProxy();\n\t}\n\n\tapplyProxy() {\n\t\tlet entity = this._entityAdaptor.entity;\n\n\t\tentity.addComponent = (componentId: string | Function, props: any) => {\n\t\t\treturn this.addComponent(componentId);\n\t\t};\n\t\tentity.removeComponent = (componentId: string | Function, index?: number) => {\n\t\t\treturn this.removeComponent(componentId, index);\n\t\t};\n\t\tentity.removeAllComponents = () => {\n\t\t\tthis.removeAllComponents();\n\t\t};\n\t\tentity.getComponent = (componentId: string | Function) => {\n\t\t\treturn this.getComponent(componentId);\n\t\t};\n\t\tentity.getComponents = (componentId: string | Function) => {\n\t\t\treturn this.getComponents(componentId);\n\t\t};\n\t}\n\n\t/**\n\t * 遍历组件\n\t * @param callback\n\t */\n\teachComponent(callback: (component: Component, index: number) => unknown) {\n\t\tthis._components.some(<any>callback);\n\t}\n\n\t/**\n\t * 设置激活状态\n\t * @param active\n\t */\n\tsetActive(active: boolean) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tif (active) {\n\t\t\t\t\tcomponent.onEnable();\n\t\t\t\t} else {\n\t\t\t\t\tcomponent.onDisable();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 时钟更新\n\t * @param t\n\t */\n\tonUpdate(t: number) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tcomponent.$onUpdate(t);\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 交互事件\n\t */\n\tonInteract(type: string, e) {\n\t\tthis.eachComponent(component => {\n\t\t\tif (component.enabled) {\n\t\t\t\tlet method = 'on' + type[0].toUpperCase() + type.substr(1);\n\n\t\t\t\tif (component[method]) {\n\t\t\t\t\tcomponent[method](e);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * 添加组件\n\t * @param componentId\n\t */\n\taddComponent(componentId: any) {\n\t\tlet component = this.$instantiateComponent(componentId);\n\t\tif (!component) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._add(component);\n\n\t\treturn component;\n\t}\n\n\t/**\n\t * 移除组件\n\t * @param componentId\n\t * @param index\n\t */\n\tremoveComponent(componentId: any, index?: number) {\n\t\tlet components;\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\tcomponents = this._findByName(componentId);\n\t\t\t\tbreak;\n\t\t\tcase 'function':\n\t\t\t\tcomponents = this._find(componentId);\n\t\t\t\tbreak;\n\t\t}\n\t\tif (index !== undefined) {\n\t\t\tcomponents = [components[index]];\n\t\t}\n\n\t\tthis._remove(components);\n\n\t\treturn components;\n\t}\n\n\t/**\n\t * 移除所有组件\n\t */\n\tremoveAllComponents() {\n\t\tthis._removeAll();\n\t}\n\n\t/**\n\t * 获取组件\n\t * @param componentId\n\t */\n\tgetComponent(componentId) {\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\treturn this._getByName(componentId);\n\t\t\tcase 'function':\n\t\t\t\treturn this._getOne(componentId);\n\t\t}\n\t}\n\n\t/**\n\t * 获取组件组\n\t * @param componentId\n\t */\n\tgetComponents(componentId) {\n\t\tswitch (typeof componentId) {\n\t\t\tcase 'string':\n\t\t\t\treturn this._findByName(componentId);\n\t\t\tcase 'function':\n\t\t\t\treturn this._find(componentId);\n\t\t}\n\t}\n\n\t/**\n\t * 添加组件\n\t * @param component\n\t * @param index\n\t */\n\tprivate _add(component: Component, index?: number) {\n\n\t\tif (index == undefined || index < 0 || index >= this._components.length) {\n\t\t\tindex = this._components.length;\n\t\t}\n\n\t\tif (component.entityAdaptor == this._entityAdaptor) {\n\t\t\tindex--;\n\t\t}\n\n\t\tconst currentIndex = this._components.indexOf(component);\n\t\tif (currentIndex == index) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentIndex >= 0) {\n\t\t\tthis._components.splice(currentIndex, 1);\n\t\t}\n\t\tthis._components.splice(index, 0, component);\n\n\t\tif (currentIndex < 0) {\n\t\t\tthis.onAddComponent(component);\n\t\t}\n\t}\n\n\t/**\n\t * 移除组件\n\t * @param components\n\t */\n\tprivate _remove(components) {\n\t\tfor (let component of components) {\n\t\t\tif (component) {\n\t\t\t\tthis.onRemoveComponent(component);\n\t\t\t\tconst index = this._components.indexOf(component);\n\t\t\t\tthis._components.splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 移除所有组件\n\t */\n\tprivate _removeAll() {\n\t\twhile (this._components.length > 0) {\n\t\t\tconst component = this._components.shift();\n\t\t\tthis.onRemoveComponent(component);\n\t\t}\n\t}\n\n\t/**\n\t * 根据组件名称获取指定类的组件列表\n\t * @param componentId\n\t */\n\tprivate _findByName<T extends Component>(componentId: string): T[] {\n\t\tlet components = this._componentsNameMapping[componentId];\n\t\tif (!components) {\n\t\t\tcomponents = this._componentsNameMapping[componentId] = <T[]>this._components.filter((component: Component) => {\n\t\t\t\treturn component.constructor['__class__'] === componentId;\n\t\t\t});\n\t\t}\n\t\treturn components;\n\t}\n\n\t/**\n\t * 获取指定类的组件列表\n\t * @param clazz\n\t */\n\tprivate _find<T extends Component>(clazz: new() => T): T[] {\n\t\tlet components = this._componentsDefMapping[clazz.name];\n\t\tif (!components) {\n\t\t\tcomponents = this._componentsDefMapping[clazz.name] = <T[]>this._components.filter((component: Component) => {\n\t\t\t\treturn component instanceof clazz;\n\t\t\t});\n\t\t}\n\t\treturn components;\n\t}\n\n\t/**\n\t * 获取指定类的组件\n\t * @param name\n\t */\n\tprivate _getByName<T extends Component>(name: string): T {\n\t\treturn this._findByName<T>(name)[0];\n\t}\n\n\t/**\n\t * 获取指定类的组件\n\t * @param clazz\n\t */\n\tprivate _getOne<T extends Component>(clazz: new() => T): T {\n\t\treturn this._find<T>(clazz)[0];\n\t}\n\n\t/**\n\t * 获取所有组件\n\t */\n\tprivate get all(): Component[] {\n\t\treturn this._components;\n\t}\n\n\t/**\n\t * 当添加组件时\n\t * @param component\n\t */\n\tprivate onAddComponent(component: Component) {\n\t\tthis._componentsNameMapping = {};\n\t\tthis._componentsDefMapping = {};\n\n\t\tcomponent.$awake(this._entityAdaptor);\n\t}\n\n\t/**\n\t * 当移除组件时\n\t * @param component\n\t */\n\tprivate onRemoveComponent(component: Component) {\n\t\tthis._componentsNameMapping = {};\n\t\tthis._componentsDefMapping = {};\n\n\t\tcomponent.enabled = false;\n\t\tcomponent.$destroy();\n\t}\n\n\t$instantiateComponent(componentId: any): Component {\n\t\tlet def = this._app.$getComponentDef(componentId);\n\t\treturn new def;\n\t}\n}\n","/**\n * Created by rockyl on 2020-03-07.\n */\n\nimport {ComponentManager} from \"./ComponentManager\";\nimport {Application} from \"./Application\";\n\n/**\n * 实体适配器接口\n */\nexport interface IEntityAdaptor {\n\t/**\n\t * 组件管理实例\n\t */\n\treadonly entity: any;\n\t/**\n\t * 实体\n\t */\n\treadonly components: ComponentManager;\n\n\t/**\n\t * 获取激活状态\n\t */\n\tgetActive(): boolean;\n\n\t/**\n\t * 设置激活状态\n\t * @param active\n\t */\n\tsetActive(active: boolean);\n\n\tinvokeLifecycle(type: string, ...args);\n\n\tinvokeInteractionEvent(type: string, ...args);\n}\n\n/**\n * 实体适配器基类\n */\nexport abstract class EntityAdaptorBase implements IEntityAdaptor {\n\tprotected readonly _components: ComponentManager;\n\tprotected readonly _entity: any;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tget components(): ComponentManager {\n\t\treturn this._components;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tget entity() {\n\t\treturn this._entity;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tgetActive(): boolean {\n\t\treturn this._entity.$active;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tsetActive(v: boolean) {\n\t\tif (v !== this.getActive()) {\n\t\t\tthis._entity.$active = v;\n\t\t\tthis._components.setActive(v);\n\t\t}\n\t}\n\n\tconstructor(entity: any, app: Application) {\n\t\tthis._entity = entity;\n\t\tthis._components = new ComponentManager(this, app);\n\n\t\tentity.entityAdaptor = this;\n\n\t\tthis.applyProxy();\n\t}\n\n\t/**\n\t * 应用代理\n\t */\n\tapplyProxy() {\n\t\tlet entity = this._entity;\n\t\tentity.$active = true;\n\n\t\tObject.defineProperty(entity, 'active', {\n\t\t\tget() {\n\t\t\t\treturn this.entityAdaptor.getActive();\n\t\t\t}\n\t\t});\n\t\tentity.setActive = this.setActive.bind(this);\n\t}\n\n\t/**\n\t * 触发生命周期方法\n\t * @param type\n\t * @param args\n\t */\n\tinvokeLifecycle(type: string, ...args) {\n\t\tif(!this.getActive()){\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (type) {\n\t\t\tcase 'update':\n\t\t\t\tconst [delta] = args;\n\t\t\t\tthis._components.onUpdate(delta);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * 触发交互事件方法\n\t * @param type\n\t * @param e\n\t */\n\tinvokeInteractionEvent(type: string, e) {\n\t\tif(!this.getActive()){\n\t\t\treturn;\n\t\t}\n\n\t\tthis._components.onInteract(type, e);\n\t}\n}\n","/**\n * Created by rockyl on 2020-03-09.\n */\n\n/**\n * 线性插值\n * @param begin number\n * @param end number\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerp(begin: number, end: number, t: number, allowOutOfBounds = false) {\n\tif (!allowOutOfBounds) {\n\t\tt = Math.max(0, Math.min(1, t));\n\t}\n\n\tlet sign = end - begin;\n\tsign = sign > 0 ? 1 : (sign < 0 ? -1 : 0);\n\tconst distance = Math.abs(end - begin);\n\n\treturn begin + distance * t * sign;\n}\n\n/**\n * 线性插值\n * @param begin\n * @param end\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerpVector2(begin: {x: number, y: number}, end: {x: number, y: number}, t: number, allowOutOfBounds = false) {\n\treturn {\n\t\tx: lerp(begin.x, end.x, t, allowOutOfBounds),\n\t\ty: lerp(begin.y, end.y, t, allowOutOfBounds),\n\t};\n}\n\n/**\n * 线性插值\n * @param begin\n * @param end\n * @param t number\n * @param allowOutOfBounds\n * @return number\n */\nexport function lerpVector3(begin: {x: number, y: number, z: number}, end: {x: number, y: number,  z: number}, t: number, allowOutOfBounds = false) {\n\treturn {\n\t\tx: lerp(begin.x, end.x, t, allowOutOfBounds),\n\t\ty: lerp(begin.y, end.y, t, allowOutOfBounds),\n\t\tz: lerp(begin.z, end.z, t, allowOutOfBounds),\n\t};\n}\n"],"names":["tslib_1.__extends"],"mappings":"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"}